import { getInMemoryContext } from '../../context/getDataContext.spec'
import { restore } from './restore'
import { TEST_USER_DATA } from '../user/createUserAccount.spec'

const ENCRYPTED_TEST_BACKUP =
  '95003c73c7749f6929ea992ef76f68d4:b7e699295ef6ae0cc72ec4c975ad650879abf5ce61d1f2bb69105b36d603d0a926198e26444dac926e6e66bb8c0be9c8faaf20964470580db3d1c255fd708e5d38e8b3c76445a7912f2f92be05b6bfa394cfa0fc9b7aa3f931ce83ad12ccc6c637eb766787a2e7d5e6c57c7b88593eb852542af7a4ce66a56ab5b77470f052a69b6ab0c195d57aa66edb31a6336f01578a126484fd67087e621e4849ec44d4df328522e960fbcdc7dba6ac3e4768ac9d21e7134e4143d62892be929716a19607d2c1591fc7607b7f81c1a080486d25d8d1a455f02afec04abcdf4998266e4c34fd2acaea184785a4bb7cf81486560135d16e6a7b58ff156b1cd716204297bc6694f97295c4800da0892370689b37f8572ca98fdbe3f361a386ccb9f5b35cf47873ebef4fb7c15395c00d15e25b2f27f8290cb57768e8fd576cb33b57c00a5fe1f01f394ab72adaf2fa126e5ef27965c90abffc3c10c7846c2d6f772064dac5b0d82fe2eddf6a1b16f7c2d2ee285c8008f7be6b27c4322fe8e8f35afd3ae71fb653f8cc36b4f135dc3192dc34d03a8ea3b75da056f1e5d52323e8d25760e17360a758717df2b7b91a64eb56a933fa40e2e8bfc137a82b07c44f435e6b2ca57b7a961e984ffebf85cd93ea5f011462cab8f52e2465c1c4f6626243a4b8cb81b27c4750184fda73ab5d1463d16815817946d91140ad3aefb823bde09f70e3627f20b452ddfe3fbca559933edeedc6a2ac46a2936c10f914907b8fef077dc6e589b9bda0f2086b645334727d4d3929ce55bc23eda5702dbfa3f1a3b7ee551b7ca57872dfb8a83ea608bc77c8175f81860ea7159c3e95d132767c1225a2a3a7bf73cd57aab65a04a4c0313150a34ff712932bf88645e80ebb1b8e0bc4517f8aeac9a1b335389ef4528246f758adbdd72b8a83be8742813f34c49ccdb1be277ff56911834ca2e19b69762a7f2b1c20b4f4836ff847accb0aaa1fc67cf44d95b61a505ce50997452e639be54e770c00d3ff7d2c32213c68c0a16a9ac71e0810511286aab3b89019936b2dbef36868999da97b11'

describe('restore', () => {
  it('should correctly restore data to a database', async () => {
    const dataContext = await getInMemoryContext()
    await restore(ENCRYPTED_TEST_BACKUP, dataContext)
    const user = await dataContext.UserAccount.findOne()
    expect(user).toBeDefined()

    const userCount = await dataContext.UserAccount.count()
    expect(userCount).toEqual(1)

    if (user) {
      expect(user.firstName).toEqual(TEST_USER_DATA.firstName)
    } else {
      expect(true).toBeFalsy()
    }
  })
})

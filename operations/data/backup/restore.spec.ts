import { getInMemoryContext } from '../../../foundation/context/getDataContext.spec'
import { restore } from './restore'
import { TEST_USER_DATA } from '../userAccount/createUserAccount.spec'

const ENCRYPTED_TEST_BACKUP =
  'aaa89d1e037397afe36c14d75233ba72:734c96cdff73f267513145025536a591bf5a2f2eb181573ee7f77e31835dfbb3b26ee3e039726e9439fcde0c3dabf4640d3722351fec13d2a3461edaafd004287be96136e9a1c1dabbdb064b8aba07ee118276d3729cfedfe6ff7d3df8fa8f3ecd517bf0a16f73f58b752d247566594833723c978cfb6cfb2c07feed56e98908eb21839c7e90eee5f75b1971ffdce453edd23e01040d33d502657dc2513418c0566dfb62d421c79d329d9113fb4df13d03be0215d487194b355e06f075d106d9edfe2e5503e9927ea87fed4047598405332331390b51da78489c001c01c1c1239c8510ba54d2e4f744205a97e6cf3d85917edec59803be10158318239af19819b923e4cc8cb76dd3ba478974de523eb2aa7941aef8b53bb6fa33945a089a7d2ff5153e1b895cb1d76459f5cfe41fe5e055cf903c2b7c55cb0bb6f1cd3cd639204a0f7abc6b3ddf3d42842798be47dfb765bc242084849fb88f2ce8b82cfd9be07b883f152bde88b4392a72ce3362c5dad90a6eded3412b2417da97f0491249c2649bb1e785efc4f98603e623d33a1cde75e1c49cf5baeae78102ae464fc737ef113c63c916704827dae593cdda57a9f4b34bccc23fc2f495c2f7206957e4d09361b69e9a4928f1cbe21643b34efef5ee080873e3e1d00962255dc5afde482c9e834921655656c63877b5cab6c92e9eb6c0e3a61f4fb0042693554def469dc0c1f085329f6d4eb6670755f99fdc9fc5275ff2b10ede44ef9c9588b42657780de1e392bff28d3fddd2b5f3cea70bd6960e6ad8a323be9293d292c2f9bc30be97314f4094b1a8e79b5ca25bf1d6e7a781b35fe472924e14e50e281a964f1d8b265ef3f74a8eae65a715a0db5ca35f7d1cca3877436e9724b3e27a193d9b6af33855dfaed41d9a04faab5f312a66fba72cb2c6974891481ef9284cd5ef8b7d44e08798e161d08c6154091312d397706f61d7eab60f8160d6cb1fa1aa65625359f62a81b02476a53fe5916fd61bc1a4bf74dadc5ab71890f6372af8b7a92bc36fae18462de27e3cb08f65ee9e56d523df05a2'

describe('restore', () => {
  it('should correctly restore data to a database', async () => {
    const dataContext = await getInMemoryContext()
    await restore(ENCRYPTED_TEST_BACKUP, dataContext)
    const user = await dataContext.UserAccount.findOne()
    expect(user).toBeDefined()

    const userCount = await dataContext.UserAccount.count()
    expect(userCount).toEqual(1)

    if (user) {
      expect(user.firstName).toEqual(TEST_USER_DATA.firstName)
    } else {
      expect(true).toBeFalsy()
    }
  })
})

import ConfigurationManager from '@/config/ConfigurationManager'
import Sequelize from 'sequelize'
import { CONFIG_DIR } from '@/constants'

{{#each Models as |model|}}
import {{model.Name}}Factory from './models/{{model.Name}}'
{{/each}}


const SQLITE_PATH = `${CONFIG_DIR}/meta.db`

const sequelize = new Sequelize('database', 'username', 'password', {
  // sqlite! now!
  dialect: 'sqlite',

  // the storage engine for sqlite
  // - default ':memory:'
  storage: SQLITE_PATH
})

const db = {
      sequelize,
      Sequelize,
      {{#each Models as |model|}}
      {{model.Name}}: {{model.Name}}Factory(sequelize),
      {{/each}}
   }

Object.values(db).forEach((model: any) => {
  if (model.associate) {
    model.associate(db)
  }
})

export default db
